---
title: "p1805_hw1_jc5457"
output: github_document
---

```{r, echo = FALSE, message=FALSE}
library(tidyverse)
library(ggridges)
library(readxl)
library(dplyr)
```

# Problem 1
**Loading the NYC transit dataset**
```{r}
transit = read_csv("data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  janitor::clean_names()%>%
  select(line, station_name, station_latitude, station_longitude,
         starts_with("route"), entry, vending, entrance_type, ada) %>%
  mutate(entry = as.logical(recode(entry, "YES" = "TRUE", "NO" = "FALSE")),
         vending = as.logical(recode(vending, "YES" = "TRUE", "NO" = "FALSE")))
```

**Describing the NYC transit dataset**
* Here, we have the NYC transit data imported, and keep 19 variables from the original csv file, including:`r names(transit)`

* And then, we transfer the two character variables "entry" and "vending" into logical variables by `recode` function.

**Answering questions**
* The distinct stations in the dataset includes: `r distinct(transit, line, station_name)`
* The number of ADA complaint station is `r sum(transit$ada=="TRUE")`
* The proportion of station entrances / exits without vending allow entrance is `r mean(transit$vending)`

**After reformating data**
```{r}

```
* The number of distinct stations serve the A train is
* The number of the stations that serve the A train, and are ADA compliant is 


# Problem 2
**Read, clean, and combine the Mr./Professor. Trash Wheel sheet**
* give reasonable names
* omit non-dumpster-specific rows
* round sports balls and convert into integer, and add a column indicating source of data
* combine the two data sets
```{r}
MR = read_excel("data/Trash Wheel Collection Data.xlsx", 
                sheet = "Mr. Trash Wheel",
                range = "A2:N550")  %>% 
  janitor::clean_names() %>% 
  drop_na() %>% 
  mutate(sports_balls = as.integer(sports_balls), 
         source = "Mr. Trash Wheel")

PROF = read_excel("data/Trash Wheel Collection Data.xlsx", 
                  sheet = "Professor Trash Wheel",
                  range = "A2:M97")  %>% 
  janitor::clean_names() %>% 
  drop_na() %>% 
  mutate(year = as.character(year),
         source = "Professor Trash Wheel")

Trash_Wheel = bind_rows(MR, PROF)
```

* The number of observations in the resulting dataset is `r count(Trash_Wheel)`,
* Key variables include: `r names(Trash_Wheel)`
* The total weight of trash collected by Professor Trash Wheel is 
`r sum(subset(Trash_Wheel, source == "Professor Trash Wheel")$weight_tons)`
* The total number of sports balls collected by Mr. Trash Wheel in 2020 is
`r sum(subset(Trash_Wheel, source == "Mr. Trash Wheel", year = "2020")$sports_balls)`


# Problem 3
**Clean and merge 3 csv files into a single data frame**
1. Clean the data in pols-month.csv. 
* Use `separate()` to break up the variable `mon` into integer variables `year`, `month`, and `day`; 
* replace month number with month name; 
* create a `president` variable taking values `gop` and `dem`, and remove `prez_dem` and `prez_gop`; 
* and remove the `day` variable.
```{r}
pols_month = 
  read_csv("data/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day"), "-")

my.month.name = Vectorize(function(n) c("January", "February", "March", 
                                         "April", "May", "June", "July", 
                                         "August", "September", "October",
                                         "November", "December")[n])

pols_month = 
  mutate(
    pols_month,
    month = str_remove(month, "^0+"),
    month = as.numeric(month), 
    month = my.month.name(month)
    ) %>% 
  pivot_longer(
    prez_gop:rep_dem,
    names_to = "president",
    values_to = "pol_value"
  ) %>%
  subset(select = -day) 
```

2. Clean the data in snp.csv using a similar process to the above. 
* For consistency across datasets, arrange according to year and month, and organize so that `year` and `month` are the leading columns.
```{r}
snp = 
  read_csv("data/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("month", "day", "year"), "/") %>% 
  mutate(
    month = as.numeric(month),
    year = as.numeric(year),
    year = ifelse(year > 90, year + 1900, year + 2000),
    month = my.month.name(month),
    ) %>% 
  subset(select = -day) %>%
  relocate(year, month) %>%
  rename(snp = close)
```

3. Tidy the unemployment data so that it can be merged with the previous datasets. 
* This process will involve switching from “wide” to “long” format; 
* ensuring that key variables have the same name & values: align month name with the pol_month and snp datasets
```{r}
unemployment =
  read_csv("data/unemployment.csv") %>% 
  janitor::clean_names() %>%
  rename(January = jan,
         February = feb,
         March = mar,
         April = apr,
         May = may,
         June = jun,
         July = jul,
         August = aug,
         September = sep,
         October = oct,
         November = nov,
         December = dec) %>% 
  pivot_longer(
    January:December,
    names_to = "month",
    values_to = "unemployment"
  ) 
```

4. Join the datasets by merging `snp` into `pols`, and merging `unemployment` into the result.
```{r}
pol_snp_unemployment = 
  merge(pols_month, snp, by = c("year", "month")) %>%
  merge(unemployment, by = c("year", "month")) 
```

**Description of dataset**
The `pols_month` dataset has `r `dim(pols_month)[1]` rows and  `r `dim(pols_month)[2]` columns. 
* The years in this dataset range from `r min(pull(pols_month, year))` to `r max(pull(pols_month, year))`. 
* The variable `president` include character `gop` and `dem`.
* The variable `pol_value` ranges from `r min(pull(pols_month, pol_value))` to `r max(pull(pols_month, pol_value))`.

The `snp` dataset has `r `dim(snp)[1]` rows and  `r `dim(snp)[2]` columns. 
* The `year` in this dataset range from `r min(pull(snp, year))` to `r max(pull(snp, year))`. 
* The variable `snp` ranges from `r min(pull(snp, snp))` to `r max(pull(snp, snp))`.

The `unemployment` dataset has `r `dim(unemployment_df)[1]` rows and  `r `dim(unemployment_df)[2]` columns. 
* The `year` in this dataset range from `r min(pull(unemployment_df, year))` to `r max(pull(unemployment_df, year))`. 
* The variable `snp` ranges from `r min(pull(unemployment_df, unemployment))` to `r max(pull(unemployment_df, unemployment))`.